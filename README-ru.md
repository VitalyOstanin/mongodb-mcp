# MongoDB MCP Сервер

Также доступно на английском: [README.md](README.md)

[![CI](https://github.com/VitalyOstanin/mongodb-mcp/actions/workflows/ci.yml/badge.svg)](https://github.com/VitalyOstanin/mongodb-mcp/actions/workflows/ci.yml)
[![npm version](https://img.shields.io/npm/v/@vitalyostanin/mongodb-mcp.svg)](https://www.npmjs.com/package/@vitalyostanin/mongodb-mcp)

**Примечание**: Этот проект разработан для моих личных нужд. Я не планирую расширять его функциональность возможностями, которые я не использую и не могу проверить. Вы свободны предлагать идеи и создавать pull request'ы, но я не гарантирую, что всё будет принято.

MCP сервер для всесторонней интеграции с MongoDB со следующими возможностями:

- **Операции с базами данных** - подключение к экземплярам MongoDB, список баз данных и коллекций
- **Управление документами** - поиск, агрегация и подсчет документов
- **Анализ схем** - анализ схем коллекций и индексов
- **Инструменты запросов** - выполнение запросов и агрегаций с полным синтаксисом MongoDB
- **Управление подключениями** - управление подключениями MongoDB с поддержкой режима только для чтения
- **Потоковое сохранение в файлы** - потоковое сохранение больших наборов данных в файлы
- **Режим только для чтения** - безопасные операции только для чтения, предотвращающие случайное изменение данных
- **Мониторинг** - статистика базы данных, метрики производительности и логи MongoDB
- **Анализ запросов** - анализ плана выполнения для оптимизации производительности

## Таблица содержимого

- [MongoDB MCP Сервер](#mongodb-mcp-сервер)
  - [Таблица содержимого](#таблица-содержимого)
  - [Требования](#требования)
  - [Конфигурация для Qwen Code](#конфигурация-для-qwen-code)
  - [Конфигурация для VS Code Cline](#конфигурация-для-vs-code-cline)
  - [MCP Инструменты](#mcp-инструменты)
    - [Сервис](#сервис)
    - [Операции с базами данных](#операции-с-базами-данных)
    - [Операции с коллекциями](#операции-с-коллекциями)
    - [Операции с документами](#операции-с-документами)
    - [Анализ схем и индексов](#анализ-схем-и-индексов)
    - [Запросы и агрегация](#запросы-и-агрегация)
    - [Мониторинг и логи](#мониторинг-и-логи)
  - [Важные замечания](#важные-замечания)
    - [Режим только для чтения](#режим-только-для-чтения)
    - [Деструктивные операции](#деструктивные-операции)

## Требования

- Node.js ≥ 20
- Переменные окружения:
  - `MONGODB_MCP_CONNECTION_STRING` — строка подключения к MongoDB (в формате mongodb:// или mongodb+srv://)
  - `MONGODB_MCP_DEFAULT_DATABASE` — опциональное имя базы данных по умолчанию для операций
  - `MONGODB_MCP_TIMEZONE` — опциональная таймзона для операций с датами (по умолчанию: `Europe/Moscow`), должна быть валидным идентификатором IANA (например, `Europe/London`, `America/New_York`, `Asia/Tokyo`)





## Конфигурация для Qwen Code

Чтобы использовать этот MCP сервер с [Qwen Code](https://qwenlm.github.io/qwen-code-docs/), добавьте в `~/.qwen/settings.json`:

```json
{
  "mcpServers": {
    "mongodb-mcp": {
      "command": "npx",
      "args": ["-y", "@vitalyostanin/mongodb-mcp@latest"],
      "env": {
        "MONGODB_MCP_CONNECTION_STRING": "mongodb://localhost:27017",
        "MONGODB_MCP_DEFAULT_DATABASE": "myapp"
      }
    }
  }
}
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Переменная окружения `MONGODB_MCP_TIMEZONE` является опциональной.

## Конфигурация для VS Code Cline

Чтобы использовать этот MCP сервер с расширением [Cline](https://github.com/cline/cline) в VS Code:

1. Откройте VS Code с установленным расширением Cline
2. Нажмите иконку MCP Servers в верхней навигации Cline
3. Выберите вкладку "Configure" и нажмите "Configure MCP Servers"
4. Добавьте следующую конфигурацию в `cline_mcp_settings.json`:

```json
{
  "mcpServers": {
    "mongodb-mcp": {
      "command": "npx",
      "args": ["-y", "@vitalyostanin/mongodb-mcp@latest"],
      "env": {
        "MONGODB_MCP_CONNECTION_STRING": "mongodb://localhost:27017",
        "MONGODB_MCP_DEFAULT_DATABASE": "myapp"
      }
    }
  }
}
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Переменная окружения `MONGODB_MCP_TIMEZONE` является опциональной.

## MCP Инструменты

### Инструменты для режима только для чтения

| Инструмент | Описание | Основные параметры |
| --- | --- | --- |
| `service_info` | Получить информацию о сервисе MongoDB, конфигурации окружения, версию и текущую таймзону | — |
| `connect` | Установить подключение к MongoDB с использованием строки подключения | — |
| `disconnect` | Отключиться от MongoDB | — |
| `list_databases` | Список всех баз данных в экземпляре MongoDB | — |
| `db_stats` | Получить статистику для определенной базы данных | `database` — имя базы данных |
| `list_collections` | Список всех коллекций для заданной базы данных | `database` — имя базы данных |
| `collection_schema` | Анализ схемы для коллекции | `database` — имя базы данных, `collection` — имя коллекции, опционально `sampleSize` (по умолчанию 50) |
| `collection_indexes` | Описание индексов для коллекции | `database` — имя базы данных, `collection` — имя коллекции |
| `collection_storage_size` | Получить размер коллекции | `database` — имя базы данных, `collection` — имя коллекции |
| `find` | Запуск find-запросов к коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, опционально `filter`, `limit` (по умолчанию 10), `projection`, `sort` |
| `count` | Подсчет документов в коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, опционально `query` — фильтр для подсчета |
| `explain` | Возвращает статистику, описывающую выполнение выигрышного плана, выбранного оптимизатором запросов | `database` — имя базы данных, `collection` — имя коллекции, `method` — объект метода с именем и аргументами, опционально `verbosity` (по умолчанию 'queryPlanner') |
| `mongodb_logs` | Возвращает самые последние записанные события mongod | опционально `limit` (по умолчанию 50), `type` (по умолчанию 'global', или 'startupWarnings') |

### Инструменты для режима с возможностью записи

| Инструмент | Описание | Основные параметры |
| --- | --- | --- |
| `aggregate` | Запуск агрегации к коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, `pipeline` — массив стадий агрегации |

**Примечание:** Инструмент `aggregate` позволяет выполнять операции только для чтения по умолчанию, но может содержать стадии, которые изменяют данные, когда сервер работает в режиме с возможностью записи. Следующие стадии агрегации ограничены в режиме только для чтения: `$out`, `$merge`. Эти стадии доступны только когда сервер запущен в режиме чтения-записи.

## Важные замечания

### Режим только для чтения

Сервер поддерживает режим только для чтения, который предотвращает разрушительные операции:

- **Защита только для чтения**: Когда используется флаг `--read-only` (по умолчанию) или переменная окружения `MONGODB_READONLY` установлена в 'true', операции записи заблокированы. Используйте `--read-only=false`, чтобы разрешить операции записи.
- **Защищенные операции**: операции `update`, `delete`, `insert`, `$out` и `$merge` запрещены
- **Безопасность подключения**: Режим только для чтения гарантирует, что случайные изменения данных не произойдут

### Деструктивные операции

Сервер MongoDB MCP работает в режиме только для чтения по умолчанию, чтобы предотвратить случайную потерю данных. Некоторые операции, которые могут изменить данные, ограничены и будут доступны только в режиме чтения-записи (который не включен по умолчанию).