# MongoDB MCP Сервер

Также доступно на английском: [README.md](README.md)

[![CI](https://github.com/VitalyOstanin/mongodb-mcp/actions/workflows/ci.yml/badge.svg)](https://github.com/VitalyOstanin/mongodb-mcp/actions/workflows/ci.yml)
[![npm version](https://img.shields.io/npm/v/@vitalyostanin/mongodb-mcp.svg)](https://www.npmjs.com/package/@vitalyostanin/mongodb-mcp)

**Примечание**: Этот проект разработан для моих личных нужд. Я не планирую расширять его функциональность возможностями, которые я не использую и не могу проверить. Вы свободны предлагать идеи и создавать pull request'ы, но я не гарантирую, что всё будет принято.

MCP сервер для всесторонней интеграции с MongoDB со следующими возможностями:

- **Операции с базами данных** - подключение к экземплярам MongoDB, список баз данных и коллекций
- **Управление документами** - поиск, агрегация и подсчет документов
- **Анализ схем** - анализ схем коллекций и индексов
- **Инструменты запросов** - выполнение запросов и агрегаций с полным синтаксисом MongoDB
- **Управление подключениями** - управление подключениями MongoDB с поддержкой режима только для чтения
- **Потоковое сохранение в файлы** - потоковое сохранение больших наборов данных в файлы
- **Режим только для чтения** - безопасные операции только для чтения, предотвращающие случайное изменение данных
- **Мониторинг** - статистика базы данных, метрики производительности и логи MongoDB
- **Анализ запросов** - анализ плана выполнения для оптимизации производительности

## Таблица содержимого

- [Таблица содержимого](#таблица-содержимого)
- [Требования](#требования)
- [Конфигурация для Qwen Code](#конфигурация-для-qwen-code)
- [Конфигурация для VS Code Cline](#конфигурация-для-vs-code-cline)
- [MCP Инструменты](#mcp-инструменты)
  - [Инструменты для режима только для чтения](#инструменты-для-режима-только-для-чтения)
  - [Инструменты для режима с возможностью записи](#инструменты-для-режима-с-возможностью-записи)

## Требования

- Node.js ≥ 20
- Переменные окружения:
  - `MONGODB_MCP_CONNECTION_STRING` — строка подключения к MongoDB (в формате mongodb:// или mongodb+srv://)
  - `MONGODB_MCP_DEFAULT_DATABASE` — опциональное имя базы данных по умолчанию для операций
  - `MONGODB_MCP_TIMEZONE` — опциональная таймзона для операций с датами (по умолчанию: `Europe/Moscow`), должна быть валидным идентификатором IANA (например, `Europe/London`, `America/New_York`, `Asia/Tokyo`)

## Конфигурация для Qwen Code

Чтобы использовать этот MCP сервер с [Qwen Code](https://qwenlm.github.io/qwen-code-docs/), добавьте в `~/.qwen/settings.json`:

```json
{
  "mcpServers": {
    "mongodb-mcp": {
      "command": "npx",
      "args": ["-y", "@vitalyostanin/mongodb-mcp@latest"],
      "env": {
        "MONGODB_MCP_CONNECTION_STRING": "mongodb://localhost:27017"
      }
    }
  }
}
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Переменная окружения `MONGODB_MCP_TIMEZONE` является опциональной.

## Конфигурация для VS Code Cline

Чтобы использовать этот MCP сервер с расширением [Cline](https://github.com/cline/cline) в VS Code:

1. Откройте VS Code с установленным расширением Cline
2. Нажмите иконку MCP Servers в верхней навигации Cline
3. Выберите вкладку "Configure" и нажмите "Configure MCP Servers"
4. Добавьте следующую конфигурацию в `cline_mcp_settings.json`:

```json
{
  "mcpServers": {
    "mongodb-mcp": {
      "command": "npx",
      "args": ["-y", "@vitalyostanin/mongodb-mcp@latest"],
      "env": {
        "MONGODB_MCP_CONNECTION_STRING": "mongodb://localhost:27017"
      }
    }
  }
}
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Переменная окружения `MONGODB_MCP_TIMEZONE` является опциональной.

## MCP Инструменты

### Инструменты для режима только для чтения

| Инструмент | Описание | Основные параметры |
| --- | --- | --- |
| `service_info` | Получить информацию о сервисе MongoDB, конфигурации окружения, версию и текущую таймзону | — |
| `connect` | Установить подключение к MongoDB с использованием строки подключения | — |
| `disconnect` | Отключиться от MongoDB | — |
| `list_databases` | Список всех баз данных в экземпляре MongoDB | — |
| `db_stats` | Получить статистику для определенной базы данных | `database` — имя базы данных |
| `list_collections` | Список всех коллекций для заданной базы данных | `database` — имя базы данных |
| `collection_schema` | Анализ схемы для коллекции | `database` — имя базы данных, `collection` — имя коллекции, опционально `sampleSize` (по умолчанию 50) |
| `collection_indexes` | Описание индексов для коллекции | `database` — имя базы данных, `collection` — имя коллекции |
| `collection_storage_size` | Получить размер коллекции | `database` — имя базы данных, `collection` — имя коллекции |
| `find` | Запуск find-запросов к коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, опционально `filter`, `limit` (по умолчанию 10), `projection`, `sort` |
| `count` | Подсчет документов в коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, опционально `query` — фильтр для подсчета |
| `explain` | Возвращает статистику, описывающую выполнение выигрышного плана, выбранного оптимизатором запросов | `database` — имя базы данных, `collection` — имя коллекции, `method` — объект метода с именем и аргументами, опционально `verbosity` (по умолчанию 'queryPlanner') |
| `mongodb_logs` | Возвращает самые последние записанные события mongod | опционально `limit` (по умолчанию 50), `type` (по умолчанию 'global', или 'startupWarnings') |

### Инструменты для режима с возможностью записи

| Инструмент | Описание | Основные параметры |
| --- | --- | --- |
| `aggregate` | Запуск агрегации к коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, `pipeline` — массив стадий агрегации |
| `insert` | Вставка одного или нескольких документов в коллекцию MongoDB | `database` — имя базы данных, `collection` — имя коллекции, `document` — одиночный документ для вставки, `documents` — массив документов для вставки (используется вместо одиночного документа) |
| `update` | Обновление одного или нескольких документов в коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, `filter` — фильтр для поиска документов для обновления, `update` — операции обновления для выполнения, `upsert` — если true, создает новый документ, если нет документов, соответствующих фильтру (по умолчанию: false), `multi` — если true, обновляет все соответствующие документы (updateMany), иначе обновляет только один (updateOne) (по умолчанию: false) |
| `delete` | Удаление одного или нескольких документов из коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, `filter` — фильтр для поиска документов для удаления, `multi` — если true, удаляет все соответствующие документы (deleteMany), иначе удаляет только один (deleteOne) (по умолчанию: false) |
| `create-index` | Создание индекса для коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, `keys` — документ спецификации индекса (например, { field: 1 } для возрастания, { field: -1 } для убывания), `options` — дополнительные параметры индекса (например, { unique: true, sparse: true }) |
| `drop-index` | Удаление индекса из коллекции MongoDB | `database` — имя базы данных, `collection` — имя коллекции, `index` — имя индекса или документ спецификации индекса для удаления |
| `create-collection` | Создание новой коллекции в базе данных MongoDB | `database` — имя базы данных, `collection` — имя создаваемой коллекции, `options` — дополнительные параметры коллекции (например, { capped: true, size: 1024 }) |
| `drop-collection` | Удаление коллекции из базы данных MongoDB | `database` — имя базы данных, `collection` — имя коллекции для удаления |

**Примечание:** Сервер по умолчанию работает в режиме только для чтения для предотвращения случайного изменения данных. В режиме только для чтения все операции записи заблокированы, включая:
- Операции на уровне базы данных: `insertOne`, `insertMany`, `updateOne`, `updateMany`, `deleteOne`, `deleteMany`, `createIndex`, `dropIndex`, `dropDatabase`, `renameCollection`, и т.д.
- Операции на уровне коллекции: `insertOne`, `insertMany`, `updateOne`, `updateMany`, `deleteOne`, `deleteMany`, `findOneAndReplace`, `findOneAndUpdate`, `findOneAndDelete`, `bulkWrite`, `createIndex`, `dropIndex`, `drop`, и т.д.
- Стадии агрегации, изменяющие данные: `$out`, `$merge`

Следующие стадии агрегации ограничены в режиме только для чтения: `$out`, `$merge`. Эти стадии доступны только когда сервер запущен в режиме чтения-записи.
